<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capitalize & Workday - Campaign Performance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: #f5f7fa; color: #2d3748; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        .loading { display: flex; align-items: center; justify-content: center; min-height: 400px; font-size: 18px; color: #718096; }
        .spinner { border: 4px solid #f3f4f6; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-right: 16px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        header { background: linear-gradient(135deg, #1a365d 0%, #2c5282 50%, #2b6cb0 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .subtitle { font-size: 14px; opacity: 0.9; }
        .last-updated { font-size: 12px; opacity: 0.8; margin-top: 8px; }
        .campaign-tabs { display: flex; gap: 10px; margin-bottom: 30px; background: white; padding: 8px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
        .campaign-tab { flex: 1; padding: 16px 24px; background: #f7fafc; border: 2px solid transparent; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; text-align: center; transition: all 0.3s; }
        .campaign-tab:hover { background: #edf2f7; }
        .campaign-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; }
        .campaign-tab.capitalize.active { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); border-color: #48bb78; }
        .campaign-tab.workday.active { background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); border-color: #4299e1; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); border-left: 4px solid #667eea; position: relative; overflow: hidden; }
        .kpi-card::before { content: ''; position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), transparent); border-radius: 0 12px 0 100%; }
        .kpi-card.green { border-left-color: #48bb78; }
        .kpi-card.green::before { background: linear-gradient(135deg, rgba(72, 187, 120, 0.1), transparent); }
        .kpi-card.blue { border-left-color: #4299e1; }
        .kpi-card.blue::before { background: linear-gradient(135deg, rgba(66, 153, 225, 0.1), transparent); }
        .kpi-card.orange { border-left-color: #ed8936; }
        .kpi-card.orange::before { background: linear-gradient(135deg, rgba(237, 137, 54, 0.1), transparent); }
        .kpi-card.purple { border-left-color: #9f7aea; }
        .kpi-card.purple::before { background: linear-gradient(135deg, rgba(159, 122, 234, 0.1), transparent); }
        .kpi-card.red { border-left-color: #f56565; }
        .kpi-card.red::before { background: linear-gradient(135deg, rgba(245, 101, 101, 0.1), transparent); }
        .kpi-label { font-size: 12px; font-weight: 600; color: #718096; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .kpi-value { font-size: 36px; font-weight: 700; color: #2d3748; margin-bottom: 4px; }
        .kpi-change { font-size: 12px; color: #718096; }
        .chart-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .chart-container { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
        .chart-title { font-size: 18px; font-weight: 700; margin-bottom: 20px; color: #2d3748; }
        .filters { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .filter-row { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; }
        .filter-group { flex: 1; min-width: 180px; }
        .filter-label { font-size: 12px; font-weight: 600; color: #718096; margin-bottom: 8px; display: block; }
        select { width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 14px; background: white; cursor: pointer; }
        select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        button { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        button:hover { background: #5568d3; transform: translateY(-1px); }
        .refresh-btn { background: #48bb78; }
        .refresh-btn:hover { background: #38a169; }
        table { width: 100%; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
        th { background: #f7fafc; padding: 16px; text-align: left; font-size: 12px; font-weight: 700; color: #4a5568; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #e2e8f0; }
        td { padding: 16px; border-bottom: 1px solid #f7fafc; font-size: 14px; }
        tr:hover { background: #f7fafc; }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .status-occurred { background: #c6f6d5; color: #22543d; }
        .status-scheduled { background: #bee3f8; color: #2c5282; }
        .status-rescheduled { background: #feebc8; color: #7c2d12; }
        .status-canceled { background: #fed7d7; color: #742a2a; }
        .funding-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .funding-capitalize { background: #c6f6d5; color: #22543d; }
        .funding-workday { background: #bee3f8; color: #2c5282; }
        .error-message { background: #fed7d7; color: #742a2a; padding: 20px; border-radius: 8px; margin: 20px 0; }
        @media (max-width: 768px) {
            .chart-grid { grid-template-columns: 1fr; }
            .kpi-grid { grid-template-columns: 1fr; }
            .campaign-tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Workday Adaptive Planning Campaign Dashboard</h1>
            <div class="subtitle">Capitalize & Workday Funded Campaigns | Live Data</div>
            <div class="last-updated" id="last-updated">Loading data...</div>
        </header>
        
        <div id="loading-indicator" class="loading">
            <div class="spinner"></div>
            <div>Loading campaign data from Google Sheets...</div>
        </div>
        
        <div id="error-container"></div>
        
        <div id="dashboard-content" style="display: none;">
            <div class="campaign-tabs">
                <div class="campaign-tab active" onclick="switchCampaign('all')" id="tab-all">
                    <div style="font-size: 18px; margin-bottom: 4px;">All Campaigns</div>
                    <div style="font-size: 11px; opacity: 0.8;">Combined View</div>
                </div>
                <div class="campaign-tab capitalize" onclick="switchCampaign('capitalize')" id="tab-capitalize">
                    <div style="font-size: 18px; margin-bottom: 4px;">Capitalize Funded</div>
                    <div style="font-size: 11px; opacity: 0.8;">CAP-WAP-A3</div>
                </div>
                <div class="campaign-tab workday" onclick="switchCampaign('workday')" id="tab-workday">
                    <div style="font-size: 18px; margin-bottom: 4px;">Workday Funded</div>
                    <div style="font-size: 11px; opacity: 0.8;">CAP-4-FY25-541-A4</div>
                </div>
            </div>
            
            <div class="kpi-grid" id="kpi-container"></div>
            
            <div class="filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">Sales Rep</label>
                        <select id="filter-rep" onchange="applyFilters()"><option value="all">All Reps</option></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">State</label>
                        <select id="filter-state" onchange="applyFilters()"><option value="all">All States</option></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Meeting Outcome</label>
                        <select id="filter-outcome" onchange="applyFilters()"><option value="all">All Outcomes</option></select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Industry</label>
                        <select id="filter-industry" onchange="applyFilters()"><option value="all">All Industries</option></select>
                    </div>
                    <div><button onclick="resetFilters()">Reset</button></div>
                    <div><button class="refresh-btn" onclick="loadData()">Refresh Data</button></div>
                </div>
            </div>
            
            <div class="chart-grid" id="charts-container"></div>
            
            <div style="margin-top: 30px;">
                <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.08);">
                    <h3 class="chart-title">Lead Details <span style="font-size: 12px; color: #718096; font-weight: 400;" id="table-count"></span></h3>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Funding</th>
                                    <th>Contact</th>
                                    <th>Company</th>
                                    <th>State</th>
                                    <th>Industry</th>
                                    <th>Sales Rep</th>
                                    <th>Status</th>
                                    <th>Convert</th>
                                </tr>
                            </thead>
                            <tbody id="table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION - UPDATE THESE WITH YOUR GOOGLE SHEET URLS
        const CONFIG = {
            // Replace these with your published Google Sheet CSV URLs
            capitalizeSheetUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQnkS83_hJIHqEl8HsjyNQO4QST99I5LDkEjY8CDkEUXQqnKI-FiA27wDiZ1DA6TbiZVI3VuumVcb-5/pub?gid=0&single=true&output=csv',
            workdaySheetUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQnkS83_hJIHqEl8HsjyNQO4QST99I5LDkEjY8CDkEUXQqnKI-FiA27wDiZ1DA6TbiZVI3VuumVcb-5/pub?gid=1927918969&single=true&output=csv'
        };

        let ALL_LEADS = [];
        let currentView = 'all';
        let filteredData = [];
        let charts = {};

        function parseCSVToLeads(csv, fundingSource) {
            const results = Papa.parse(csv, { header: true, skipEmptyLines: true });
            return results.data.map(row => ({
                fundingSource: fundingSource,
                name: `${row['First Name'] || ''} ${row['Last Name'] || ''}`.trim(),
                company: row['Company Name'] || '',
                state: row['Company State'] || '',
                industry: row['Industry'] || '',
                salesRep: row['Sales Rep'] || '',
                campaign: row['All Campaign Names'] || '',
                outcome: (row['Current Meeting Outcome'] || '').trim(),
                revenue: row['Annual Revenue'] || '',
                headcount: parseInt(row['Company Headcount']) || 0,
                roiStatus: row['ROI Tracker Status'] || 'N/A',
                workdayReg: row['Are you registering this lead with Workday within the next 30 Days?'] || 'N/A',
                convertToOpp: row['Are you converting this lead to an opportunity?'] || 'N/A',
                dealSize: row['If yes, how much is the potential deal size?'] || 'N/A',
                meetingDate: row['Current Meeting Date'] || 'N/A'
            }));
        }

        async function loadData() {
            try {
                document.getElementById('loading-indicator').style.display = 'flex';
                document.getElementById('dashboard-content').style.display = 'none';
                document.getElementById('error-container').innerHTML = '';

                // Fetch both sheets
                const [capitalizeResponse, workdayResponse] = await Promise.all([
                    fetch(CONFIG.capitalizeSheetUrl),
                    fetch(CONFIG.workdaySheetUrl)
                ]);

                if (!capitalizeResponse.ok || !workdayResponse.ok) {
                    throw new Error('Failed to fetch data from Google Sheets. Please check your URLs.');
                }

                const [capitalizeCSV, workdayCSV] = await Promise.all([
                    capitalizeResponse.text(),
                    workdayResponse.text()
                ]);

                // Parse the data
                const capitalizeLeads = parseCSVToLeads(capitalizeCSV, 'Capitalize Funded');
                const workdayLeads = parseCSVToLeads(workdayCSV, 'Workday Funded');

                ALL_LEADS = [...capitalizeLeads, ...workdayLeads];

                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';
                
                const now = new Date();
                document.getElementById('last-updated').textContent = `Last updated: ${now.toLocaleString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                })}`;

                resetFilters();
            } catch (error) {
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('error-container').innerHTML = `
                    <div class="error-message">
                        <strong>Error loading data:</strong> ${error.message}
                        <br><br>
                        Please check that you've updated the Google Sheet URLs in the configuration section of this file.
                    </div>
                `;
            }
        }

        function switchCampaign(view) {
            currentView = view;
            document.querySelectorAll('.campaign-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab-${view}`).classList.add('active');
            resetFilters();
        }

        function getViewData() {
            if (currentView === 'capitalize') return ALL_LEADS.filter(l => l.fundingSource === 'Capitalize Funded');
            if (currentView === 'workday') return ALL_LEADS.filter(l => l.fundingSource === 'Workday Funded');
            return ALL_LEADS;
        }

        function initFilters() {
            const viewData = getViewData();
            const reps = [...new Set(viewData.map(l => l.salesRep))].filter(r => r).sort();
            const states = [...new Set(viewData.map(l => l.state))].filter(s => s).sort();
            const outcomes = [...new Set(viewData.map(l => l.outcome))].filter(o => o).sort();
            const industries = [...new Set(viewData.map(l => l.industry))].filter(i => i).sort();
            
            updateSelect('filter-rep', reps);
            updateSelect('filter-state', states);
            updateSelect('filter-outcome', outcomes, true);
            updateSelect('filter-industry', industries);
        }

        function updateSelect(id, values, skipDefault = false) {
            const select = document.getElementById(id);
            select.innerHTML = skipDefault ? '' : '<option value="all">All</option>';
            values.forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                select.appendChild(option);
            });
        }

        function applyFilters() {
            const viewData = getViewData();
            const filters = {
                rep: document.getElementById('filter-rep').value,
                state: document.getElementById('filter-state').value,
                outcome: document.getElementById('filter-outcome').value,
                industry: document.getElementById('filter-industry').value
            };
            
            filteredData = viewData.filter(lead => 
                (filters.rep === 'all' || lead.salesRep === filters.rep) &&
                (filters.state === 'all' || lead.state === filters.state) &&
                (filters.outcome === 'all' || lead.outcome === filters.outcome) &&
                (filters.industry === 'all' || lead.industry === filters.industry)
            );
            
            updateDashboard();
        }

        function resetFilters() {
            ['filter-rep', 'filter-state', 'filter-outcome', 'filter-industry'].forEach(id => 
                document.getElementById(id).value = 'all'
            );
            filteredData = getViewData();
            initFilters();
            updateDashboard();
        }

        function updateKPIs() {
            const occurred = filteredData.filter(l => l.outcome.includes('Occurred')).length;
            const scheduled = filteredData.filter(l => l.outcome === 'To Occur').length;
            const rescheduled = filteredData.filter(l => l.outcome === 'To Be Rescheduled').length;
            const canceled = filteredData.filter(l => l.outcome === 'Canceled').length;
            const converting = filteredData.filter(l => l.convertToOpp === 'Yes').length;
            const workdayReg = filteredData.filter(l => l.workdayReg === 'Yes').length;
            
            const completionRate = filteredData.length > 0 ? Math.round((occurred / filteredData.length) * 100) : 0;
            const conversionRate = occurred > 0 ? Math.round((converting / occurred) * 100) : 0;
            
            document.getElementById('kpi-container').innerHTML = `
                <div class="kpi-card purple">
                    <div class="kpi-label">Total Leads</div>
                    <div class="kpi-value">${filteredData.length}</div>
                    <div class="kpi-change">${currentView === 'all' ? 'All Campaigns' : currentView === 'capitalize' ? 'Capitalize Funded' : 'Workday Funded'}</div>
                </div>
                <div class="kpi-card green">
                    <div class="kpi-label">Meetings Occurred</div>
                    <div class="kpi-value">${occurred}</div>
                    <div class="kpi-change">${completionRate}% completion rate</div>
                </div>
                <div class="kpi-card blue">
                    <div class="kpi-label">Scheduled</div>
                    <div class="kpi-value">${scheduled}</div>
                    <div class="kpi-change">Upcoming meetings</div>
                </div>
                <div class="kpi-card orange">
                    <div class="kpi-label">Converting to Opps</div>
                    <div class="kpi-value">${converting}</div>
                    <div class="kpi-change">${conversionRate}% of completed</div>
                </div>
                <div class="kpi-card red">
                    <div class="kpi-label">Rescheduled</div>
                    <div class="kpi-value">${rescheduled}</div>
                    <div class="kpi-change">${canceled} canceled</div>
                </div>
                <div class="kpi-card purple">
                    <div class="kpi-label">Workday Registration</div>
                    <div class="kpi-value">${workdayReg}</div>
                    <div class="kpi-change">Next 30 days</div>
                </div>
            `;
        }

        function updateTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            document.getElementById('table-count').textContent = `Showing ${filteredData.length} leads`;
            
            filteredData.forEach(lead => {
                const row = document.createElement('tr');
                const outcome = lead.outcome;
                let statusClass = 'status-scheduled';
                if (outcome.includes('Occurred')) statusClass = 'status-occurred';
                else if (outcome === 'To Be Rescheduled') statusClass = 'status-rescheduled';
                else if (outcome === 'Canceled') statusClass = 'status-canceled';
                
                const fundingClass = lead.fundingSource === 'Capitalize Funded' ? 'funding-capitalize' : 'funding-workday';
                
                row.innerHTML = `
                    <td><span class="funding-badge ${fundingClass}">${lead.fundingSource.replace(' Funded', '')}</span></td>
                    <td>${lead.name}</td>
                    <td>${lead.company}</td>
                    <td>${lead.state}</td>
                    <td>${lead.industry}</td>
                    <td>${lead.salesRep}</td>
                    <td><span class="status-badge ${statusClass}">${outcome}</span></td>
                    <td>${lead.convertToOpp}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function createCharts() {
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};
            
            document.getElementById('charts-container').innerHTML = `
                <div class="chart-container"><h3 class="chart-title">Sales Rep Performance</h3><canvas id="rep-chart"></canvas></div>
                <div class="chart-container"><h3 class="chart-title">Meeting Outcomes</h3><canvas id="outcome-chart"></canvas></div>
                <div class="chart-container"><h3 class="chart-title">Top States</h3><canvas id="state-chart"></canvas></div>
                <div class="chart-container"><h3 class="chart-title">Industry Distribution</h3><canvas id="industry-chart"></canvas></div>
            `;
            
            const repCounts = {};
            filteredData.forEach(lead => repCounts[lead.salesRep] = (repCounts[lead.salesRep] || 0) + 1);
            const sortedReps = Object.entries(repCounts).sort((a, b) => b[1] - a[1]);
            
            charts.rep = new Chart(document.getElementById('rep-chart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: sortedReps.map(r => r[0]),
                    datasets: [{ label: 'Leads', data: sortedReps.map(r => r[1]), backgroundColor: '#667eea', borderRadius: 6 }]
                },
                options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
            });
            
            const outcomeCounts = {};
            filteredData.forEach(lead => outcomeCounts[lead.outcome] = (outcomeCounts[lead.outcome] || 0) + 1);
            
            charts.outcome = new Chart(document.getElementById('outcome-chart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(outcomeCounts),
                    datasets: [{ data: Object.values(outcomeCounts), backgroundColor: ['#48bb78', '#4299e1', '#ed8936', '#f56565'] }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });
            
            const stateCounts = {};
            filteredData.forEach(lead => stateCounts[lead.state] = (stateCounts[lead.state] || 0) + 1);
            const topStates = Object.entries(stateCounts).sort((a, b) => b[1] - a[1]).slice(0, 10);
            
            charts.state = new Chart(document.getElementById('state-chart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: topStates.map(s => s[0]),
                    datasets: [{ label: 'Leads', data: topStates.map(s => s[1]), backgroundColor: '#9f7aea', borderRadius: 6 }]
                },
                options: { responsive: true, maintainAspectRatio: true, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, ticks: { stepSize: 1 } } } }
            });
            
            const industryCounts = {};
            filteredData.forEach(lead => industryCounts[lead.industry] = (industryCounts[lead.industry] || 0) + 1);
            
            charts.industry = new Chart(document.getElementById('industry-chart').getContext('2d'), {
                type: 'pie',
                data: {
                    labels: Object.keys(industryCounts),
                    datasets: [{
                        data: Object.values(industryCounts),
                        backgroundColor: ['#667eea', '#48bb78', '#4299e1', '#ed8936', '#9f7aea', '#38b2ac', '#f56565', '#ecc94b', '#ed64a6', '#f687b3', '#fc8181', '#f6ad55', '#68d391', '#4fd1c5', '#63b3ed']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true }
            });
        }

        function updateDashboard() {
            updateKPIs();
            updateTable();
            createCharts();
        }

        window.addEventListener('DOMContentLoaded', () => loadData());
    </script>
</body>
</html>